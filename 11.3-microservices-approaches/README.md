# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

### Решение

Для удовлетворения всех требований можно использовать *GitLab*, инструмент *GitLab CI/CD* и *Gitlab Runner*.  
  
**GitLab** - облачная платформа контроля версий. Позволяет создавать репозитории для каждого сервиса.  
  
**GitLab Ci/CD** - инструмент непрерывной интеграции и поставки, интегрируемый в систему контроля версий *GitLab*.  
Позволяет:
- запускать сборку по событию (н.п. по коммиту в определённой ветке)
- запускать сборку вручную/по кнопке с указанием ветки, тэга, переменных окружения и др.
- привязать настройки для каждой сборки переменными окружения или описаннием в конф.файле `.gitlab-ci.yml`
- создавать шаблоны для различных конфигураций сборок в файле `.gitlab-ci.yml`, которые могут храниться в хранилище шаблонов, репозитории проекта, глобальной конфигурации *gitlab* или внешнем хранилище
- хранить пароли и ключи доступа в зашифрованном виде в переменных окружения
- запускать несколько конфигураций сборки описав их в файле конфигурации отдельными *job*-ами
- использовать кастомные шаги при сборке с помощью скриптов, написанных на любом поддерживаемом языке программирования
- создавать Docker-образы на основе Dockerfile, в который будет вложен артефакт, полученный в результате сборки  
  
**GitLab Runner** - агент устанавливаемый на отдельные сервера для выполнения задач поступающих от *GitLab CI/CD*.  
Позволяет:
- параллельно запускать несколько сборок на доступных машинах, где установлен *Runner*
- параллельно запускать несколько тестов на доступных машинах, где установлен *Runner*



## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

### Решение

В данном случае решением для сбора и анализа логов может послужить **ELK-стек**, включающий *Elasticsearch*, *Logstash* и *Kibana*.  

**Logstash** - средство сбора логов. Собирает логи со всех хостов обслуживающих систему. Может принимать логи из разных источников, в том числе *stdout* приложений и отправлять их в централизованное хранилище.
  
Гарантировать доставку логов в *ELK-стеке* можно за счёт безопасного соединения HTTPS между *Logstash* и *Elasticsearch*, подтверждения доставки, буферизация и очередей и др.
  
**Elasticsearch** - инструмент сбора, хранения и анализа логов. В *ELK-стеке* он также выступает в качестве централизованного хранилища логов.  
С помощью языка запросов *Query DSL* в *Elasticsearch* можно производить поиск и фильтрацию информации по логам.
  
**Kibana** - инструмент визуализации и анализа логов. Предоставляет разработчикам дашборды, графики и другие инструменты для поиска и анализа логов. Также *Kibana* позволяет сохранить ссылку на поиск по логам.


## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

---
